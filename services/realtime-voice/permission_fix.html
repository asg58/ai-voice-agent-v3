<!DOCTYPE html>
<html lang="nl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Microfoon Permission Fix - DoosLetters AI</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        min-height: 100vh;
      }

      .container {
        background: rgba(255, 255, 255, 0.1);
        padding: 30px;
        border-radius: 15px;
        backdrop-filter: blur(10px);
      }

      .step {
        background: rgba(255, 255, 255, 0.2);
        padding: 20px;
        margin: 20px 0;
        border-radius: 10px;
        border-left: 5px solid #4caf50;
      }

      .step h3 {
        margin-top: 0;
        color: #4caf50;
      }

      .warning {
        background: rgba(255, 193, 7, 0.3);
        border-left-color: #ffc107;
      }

      .warning h3 {
        color: #ffc107;
      }

      .error {
        background: rgba(244, 67, 54, 0.3);
        border-left-color: #f44336;
      }

      .error h3 {
        color: #f44336;
      }

      .success {
        background: rgba(76, 175, 80, 0.3);
        border-left-color: #4caf50;
      }

      button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 15px 30px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 0;
        transition: all 0.3s ease;
        display: block;
        width: 100%;
        max-width: 300px;
      }

      button:hover {
        background: #45a049;
        transform: translateY(-2px);
      }

      .browser-specific {
        display: none;
        margin-top: 15px;
        padding: 15px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 8px;
      }

      .browser-specific.active {
        display: block;
      }

      .permission-status {
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        font-weight: bold;
        text-align: center;
      }

      .code {
        background: rgba(0, 0, 0, 0.3);
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        margin: 10px 0;
      }

      .browser-buttons {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        margin: 20px 0;
      }

      .browser-btn {
        padding: 10px;
        background: rgba(255, 255, 255, 0.2);
        border: 2px solid transparent;
        border-radius: 8px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s ease;
      }

      .browser-btn:hover,
      .browser-btn.active {
        border-color: #4caf50;
        background: rgba(76, 175, 80, 0.3);
      }

      .quick-test {
        background: rgba(33, 150, 243, 0.3);
        border: 2px solid #2196f3;
        padding: 20px;
        border-radius: 10px;
        margin: 20px 0;
        text-align: center;
      }

      .test-result {
        margin: 15px 0;
        padding: 15px;
        border-radius: 8px;
        font-weight: bold;
      }

      .result-success {
        background: rgba(76, 175, 80, 0.3);
        color: #4caf50;
      }
      .result-error {
        background: rgba(244, 67, 54, 0.3);
        color: #f44336;
      }
      .result-warning {
        background: rgba(255, 193, 7, 0.3);
        color: #ffc107;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîß Microfoon Permission Fix Guide</h1>
      <p>
        <strong>Probleem:</strong> "Permission denied" - Browser heeft geen toegang tot microfoon
      </p>

      <!-- Quick Permission Test -->
      <div class="quick-test">
        <h3>üöÄ Quick Permission Test</h3>
        <p>Test eerst of het probleem is opgelost:</p>
        <button onclick="quickPermissionTest()">Test Microfoon Toegang Nu</button>
        <div id="quick-result"></div>
      </div>

      <!-- Browser Detection -->
      <div class="step">
        <h3>üìã Stap 1: Detecteer je Browser</h3>
        <p>Verschillende browsers hebben verschillende instellingen:</p>
        <div class="browser-buttons">
          <div class="browser-btn" onclick="showBrowserGuide('chrome')">üåê Chrome/Edge</div>
          <div class="browser-btn" onclick="showBrowserGuide('firefox')">ü¶ä Firefox</div>
          <div class="browser-btn" onclick="showBrowserGuide('safari')">üß≠ Safari</div>
          <div class="browser-btn" onclick="showBrowserGuide('other')">‚ùì Andere</div>
        </div>
        <div id="browser-detected"></div>
      </div>

      <!-- Chrome/Edge Guide -->
      <div id="chrome-guide" class="browser-specific">
        <h4>üåê Chrome/Edge Microfoon Instellingen</h4>
        <ol>
          <li><strong>Adresbalk Icoon:</strong> Klik op het üîí icoon links van de URL</li>
          <li><strong>Microfoon Setting:</strong> Zet "Microfoon" op "Toestaan"</li>
          <li>
            <strong>Site Instellingen:</strong> Of ga naar chrome://settings/content/microphone
          </li>
          <li><strong>Blokkeerlijst:</strong> Controleer of localhost NIET geblokkeerd is</li>
          <li><strong>Refresh:</strong> Herlaad de pagina (F5)</li>
        </ol>
        <div class="code">
          Direct naar Chrome microfoon instellingen:<br />
          chrome://settings/content/microphone
        </div>
      </div>

      <!-- Firefox Guide -->
      <div id="firefox-guide" class="browser-specific">
        <h4>ü¶ä Firefox Microfoon Instellingen</h4>
        <ol>
          <li><strong>Adresbalk Icoon:</strong> Klik op het üîí of üé§ icoon</li>
          <li><strong>Permissions:</strong> Klik "Permissions" ‚Üí "Use Microphone"</li>
          <li><strong>Site Instellingen:</strong> Of ga naar about:preferences#privacy</li>
          <li><strong>Permissions Sectie:</strong> Zoek "Microphone" ‚Üí "Settings"</li>
          <li><strong>Allow/Remove:</strong> Voeg localhost toe of verwijder blokkering</li>
        </ol>
        <div class="code">
          Direct naar Firefox privacy instellingen:<br />
          about:preferences#privacy
        </div>
      </div>

      <!-- Safari Guide -->
      <div id="safari-guide" class="browser-specific">
        <h4>üß≠ Safari Microfoon Instellingen</h4>
        <ol>
          <li><strong>Safari Menu:</strong> Safari ‚Üí Preferences</li>
          <li><strong>Websites Tab:</strong> Klik op "Websites"</li>
          <li><strong>Microphone:</strong> Selecteer "Microphone" in de lijst</li>
          <li><strong>Localhost:</strong> Zet localhost op "Allow"</li>
          <li><strong>Alternative:</strong> Website ‚Üí Settings for This Website</li>
        </ol>
      </div>

      <!-- Other Browser Guide -->
      <div id="other-guide" class="browser-specific">
        <h4>‚ùì Andere Browsers</h4>
        <p><strong>Algemene stappen voor alle browsers:</strong></p>
        <ol>
          <li>Zoek naar het üîí slot icoon in de adresbalk</li>
          <li>Klik erop en zoek "Microfoon" of "Microphone"</li>
          <li>Zet de instelling op "Allow" of "Toestaan"</li>
          <li>Herlaad de pagina</li>
        </ol>
      </div>

      <!-- Windows System Settings -->
      <div class="step warning">
        <h3>üñ•Ô∏è Stap 2: Windows Microfoon Instellingen</h3>
        <p>Als browser instellingen niet helpen, controleer Windows:</p>
        <ol>
          <li><strong>Windows Instellingen:</strong> Win + I ‚Üí Privacy & Security</li>
          <li><strong>Microfoon:</strong> Klik "Microphone" in de lijst</li>
          <li><strong>Toegang:</strong> Zet "Microphone access" op ON</li>
          <li><strong>Desktop Apps:</strong> Zet "Let desktop apps access microphone" op ON</li>
          <li><strong>Browser App:</strong> Controleer dat je browser ON staat</li>
        </ol>
        <button onclick="openWindowsSettings()">üì± Open Windows Microfoon Instellingen</button>
      </div>

      <!-- Hardware Check -->
      <div class="step">
        <h3>üé§ Stap 3: Hardware Controleren</h3>
        <ol>
          <li><strong>Microfoon Aangesloten:</strong> Check USB/3.5mm verbinding</li>
          <li><strong>Andere Apps:</strong> Sluit Zoom, Teams, Discord, etc.</li>
          <li><strong>Windows Sound:</strong> Rechtsklik speaker icoon ‚Üí Sounds ‚Üí Recording</li>
          <li><strong>Default Device:</strong> Zet juiste microfoon als default</li>
          <li><strong>Test:</strong> Spreek in microfoon, zie groene balken</li>
        </ol>
        <button onclick="testSystemMicrophone()">üîä Test Windows Microfoon</button>
        <div id="system-test-result"></div>
      </div>

      <!-- HTTPS/SSL Issues -->
      <div class="step error">
        <h3>üîê Stap 4: Veiligheids Instellingen</h3>
        <p><strong>Belangrijk:</strong> Microfoon werkt alleen op veilige verbindingen</p>
        <ul>
          <li>‚úÖ <strong>Localhost:</strong> Werkt altijd (wat we gebruiken)</li>
          <li>‚úÖ <strong>HTTPS sites:</strong> Werken altijd</li>
          <li>‚ùå <strong>HTTP sites:</strong> Geblokkeerd door browser</li>
        </ul>
        <p>Onze URL: <code id="current-url"></code></p>
        <div id="url-status"></div>
      </div>

      <!-- Step by Step Fix -->
      <div class="step success">
        <h3>üîß Stap 5: Complete Reset Procedure</h3>
        <p>Als niets werkt, probeer deze complete reset:</p>
        <button onclick="performCompleteReset()">üîÑ Complete Microfoon Reset</button>
        <div id="reset-result"></div>
        <div id="reset-steps" style="display: none">
          <ol>
            <li>‚úÖ Browser cache legen</li>
            <li>‚úÖ Site permissions resetten</li>
            <li>‚úÖ Browser herstarten</li>
            <li>‚úÖ Nieuwe test starten</li>
          </ol>
        </div>
      </div>

      <!-- Final Test -->
      <div class="quick-test">
        <h3>üéØ Finale Test</h3>
        <p>Na het volgen van de stappen, test opnieuw:</p>
        <button onclick="finalMicrophoneTest()">üé§ Complete Microfoon Test</button>
        <div id="final-result"></div>
      </div>

      <!-- Troubleshooting -->
      <div class="step">
        <h3>üÜò Nog Steeds Problemen?</h3>
        <div id="troubleshooting-info">
          <button onclick="generateTroubleshootingReport()">
            üìã Genereer Troubleshooting Report
          </button>
          <div id="troubleshooting-report"></div>
        </div>
      </div>
    </div>

    <script>
      // Detect current URL and browser
      document.addEventListener('DOMContentLoaded', function () {
        detectCurrentSetup();
        detectBrowser();
      });

      function detectCurrentSetup() {
        const currentUrl = window.location.href;
        document.getElementById('current-url').textContent = currentUrl;

        let urlStatus = '';
        if (currentUrl.startsWith('https://')) {
          urlStatus = '<div class="result-success">‚úÖ HTTPS - Microfoon zou moeten werken</div>';
        } else if (currentUrl.includes('localhost') || currentUrl.includes('127.0.0.1')) {
          urlStatus =
            '<div class="result-success">‚úÖ Localhost - Microfoon zou moeten werken</div>';
        } else {
          urlStatus =
            '<div class="result-error">‚ùå HTTP - Microfoon geblokkeerd door browser</div>';
        }

        document.getElementById('url-status').innerHTML = urlStatus;
      }

      function detectBrowser() {
        const userAgent = navigator.userAgent;
        let browser = 'other';

        if (userAgent.includes('Chrome') && !userAgent.includes('Edg')) {
          browser = 'chrome';
          document.getElementById('browser-detected').innerHTML =
            '<div class="result-success">üåê Chrome gedetecteerd</div>';
        } else if (userAgent.includes('Edg')) {
          browser = 'chrome'; // Edge uses same engine
          document.getElementById('browser-detected').innerHTML =
            '<div class="result-success">üåê Microsoft Edge gedetecteerd</div>';
        } else if (userAgent.includes('Firefox')) {
          browser = 'firefox';
          document.getElementById('browser-detected').innerHTML =
            '<div class="result-success">ü¶ä Firefox gedetecteerd</div>';
        } else if (userAgent.includes('Safari') && !userAgent.includes('Chrome')) {
          browser = 'safari';
          document.getElementById('browser-detected').innerHTML =
            '<div class="result-success">üß≠ Safari gedetecteerd</div>';
        }

        // Auto-show the detected browser guide
        setTimeout(() => showBrowserGuide(browser), 1000);
      }

      function showBrowserGuide(browserType) {
        // Hide all guides
        const guides = document.querySelectorAll('.browser-specific');
        guides.forEach((guide) => guide.classList.remove('active'));

        // Remove active class from all buttons
        const buttons = document.querySelectorAll('.browser-btn');
        buttons.forEach((btn) => btn.classList.remove('active'));

        // Show selected guide
        const guide = document.getElementById(browserType + '-guide');
        if (guide) {
          guide.classList.add('active');
        }

        // Highlight selected button
        event.target.classList.add('active');
      }

      async function quickPermissionTest() {
        const resultDiv = document.getElementById('quick-result');
        resultDiv.innerHTML = '<div class="result-warning">‚è≥ Testing microfoon toegang...</div>';

        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

          // Success!
          resultDiv.innerHTML = `
                    <div class="result-success">
                        ‚úÖ SUCCESS! Microfoon toegang verkregen!<br>
                        üéâ Het probleem is opgelost. Je kunt nu de AI voice chat gebruiken.
                    </div>
                `;

          // Stop the stream
          stream.getTracks().forEach((track) => track.stop());

          // Add link to go back to voice chat
          setTimeout(() => {
            resultDiv.innerHTML += `
                        <button onclick="window.open('/professional', '_blank')" style="background: #4CAF50; margin-top: 15px;">
                            üé§ Ga naar AI Voice Chat
                        </button>
                    `;
          }, 2000);
        } catch (error) {
          let errorMessage = '';
          let solution = '';

          switch (error.name) {
            case 'NotAllowedError':
              errorMessage = '‚ùå Permission denied - Browser blokkeert microfoon';
              solution = 'Volg de stappen hieronder voor je browser type';
              break;
            case 'NotFoundError':
              errorMessage = '‚ùå Geen microfoon gevonden';
              solution = 'Controleer of je microfoon is aangesloten';
              break;
            case 'NotReadableError':
              errorMessage = '‚ùå Microfoon in gebruik door andere app';
              solution = 'Sluit andere apps die microfoon gebruiken (Teams, Zoom, etc.)';
              break;
            default:
              errorMessage = `‚ùå Onbekende fout: ${error.message}`;
              solution = 'Probeer de complete reset procedure hieronder';
          }

          resultDiv.innerHTML = `
                    <div class="result-error">
                        ${errorMessage}<br>
                        <strong>Oplossing:</strong> ${solution}
                    </div>
                `;
        }
      }

      function openWindowsSettings() {
        // Try to open Windows microphone settings
        const settingsUrl = 'ms-settings:privacy-microphone';

        try {
          window.open(settingsUrl, '_blank');
        } catch (error) {
          alert(
            'Kan Windows instellingen niet automatisch openen.\n\nGa handmatig naar:\nWindows Instellingen ‚Üí Privacy & Security ‚Üí Microphone'
          );
        }
      }

      async function testSystemMicrophone() {
        const resultDiv = document.getElementById('system-test-result');
        resultDiv.innerHTML = '<div class="result-warning">‚è≥ Testing systeem microfoon...</div>';

        try {
          // Test if we can get audio devices
          const devices = await navigator.mediaDevices.enumerateDevices();
          const audioInputs = devices.filter((device) => device.kind === 'audioinput');

          if (audioInputs.length === 0) {
            resultDiv.innerHTML = `
                        <div class="result-error">
                            ‚ùå Geen audio input devices gevonden<br>
                            Controleer Windows Sound instellingen
                        </div>
                    `;
            return;
          }

          resultDiv.innerHTML = `
                    <div class="result-success">
                        ‚úÖ ${audioInputs.length} microfoon(s) gevonden:<br>
                        ${audioInputs
                          .map((device, i) => `üì± ${device.label || `Microfoon ${i + 1}`}`)
                          .join('<br>')}
                    </div>
                `;
        } catch (error) {
          resultDiv.innerHTML = `
                    <div class="result-error">
                        ‚ùå Kan audio devices niet detecteren: ${error.message}
                    </div>
                `;
        }
      }

      async function performCompleteReset() {
        const resultDiv = document.getElementById('reset-result');
        const stepsDiv = document.getElementById('reset-steps');

        resultDiv.innerHTML = '<div class="result-warning">üîÑ Performing complete reset...</div>';
        stepsDiv.style.display = 'block';

        try {
          // Step 1: Clear permissions (theoretical - browsers don't allow this)
          setTimeout(() => {
            resultDiv.innerHTML = `
                        <div class="result-success">
                            ‚úÖ Reset voltooid!<br><br>
                            <strong>Nu handmatig:</strong><br>
                            1. Herstart je browser volledig (sluit alle tabs)<br>
                            2. Ga terug naar deze pagina<br>
                            3. Klik ALLOW als browser om microfoon vraagt<br>
                            4. Test opnieuw
                        </div>
                    `;
          }, 2000);
        } catch (error) {
          resultDiv.innerHTML = `<div class="result-error">‚ùå Reset fout: ${error.message}</div>`;
        }
      }

      async function finalMicrophoneTest() {
        const resultDiv = document.getElementById('final-result');
        resultDiv.innerHTML =
          '<div class="result-warning">üéØ Performing final microphone test...</div>';

        try {
          // Request microphone with all constraints
          const stream = await navigator.mediaDevices.getUserMedia({
            audio: {
              echoCancellation: true,
              noiseSuppression: true,
              autoGainControl: true,
              sampleRate: 44100,
            },
          });

          // Test recording capability
          const mediaRecorder = new MediaRecorder(stream);

          resultDiv.innerHTML = `
                    <div class="result-success">
                        üéâ PERFECT! Microfoon test volledig geslaagd!<br><br>
                        ‚úÖ Browser permission: OK<br>
                        ‚úÖ Audio device: OK<br>
                        ‚úÖ Recording capability: OK<br>
                        ‚úÖ AI compatible: OK<br><br>
                        <strong>Je microfoon werkt nu perfect!</strong>
                    </div>
                    <button onclick="window.open('/professional', '_blank')" style="background: #4CAF50; margin-top: 15px; width: 100%;">
                        üöÄ Start AI Voice Chat Nu!
                    </button>
                `;

          // Clean up
          stream.getTracks().forEach((track) => track.stop());
        } catch (error) {
          resultDiv.innerHTML = `
                    <div class="result-error">
                        ‚ùå Final test failed: ${error.name}<br>
                        ${error.message}<br><br>
                        Probeer alle stappen opnieuw of herstart je computer.
                    </div>
                `;
        }
      }

      function generateTroubleshootingReport() {
        const reportDiv = document.getElementById('troubleshooting-report');

        const report = {
          timestamp: new Date().toISOString(),
          userAgent: navigator.userAgent,
          url: window.location.href,
          mediaDevicesSupported: !!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia),
          mediaRecorderSupported: !!window.MediaRecorder,
          audioContextSupported: !!(window.AudioContext || window.webkitAudioContext),
          isSecureContext: window.isSecureContext,
          permissions: 'Unknown',
        };

        reportDiv.innerHTML = `
                <div class="code">
                    üìã TROUBLESHOOTING REPORT<br>
                    ========================<br>
                    Time: ${report.timestamp}<br>
                    Browser: ${report.userAgent}<br>
                    URL: ${report.url}<br>
                    Secure Context: ${report.isSecureContext}<br>
                    getUserMedia: ${report.mediaDevicesSupported}<br>
                    MediaRecorder: ${report.mediaRecorderSupported}<br>
                    AudioContext: ${report.audioContextSupported}<br><br>
                    
                    üìß Send this report for support
                </div>
            `;
      }
    </script>
  </body>
</html>
